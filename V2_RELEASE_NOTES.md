# ملاحظات الإصدار الثاني | خطوات ERP

## ما تم تنفيذه

### 1. الطلبات – مراحل وسير عمل
- **مراحل الطلب:** قيد الانتظار → تم التأكيد → قيد التحضير → جاهز للشحن → تم الشحن → تم التوصيل → ملغي
- **سجل التغييرات:** جدول `order_status_history` يسجل كل تغيير مع التاريخ والمستخدم
- **رقم الطلب:** تنسيق تلقائي `ORD-YYYYMMDD-0001`
- **رقم التتبع:** حقل لحفظ رقم تتبع الشحن
- **ملاحظات التاجر:** حقل ملاحظات داخلية للطلب
- **فلترة:** فلترة الطلبات حسب الحالة

### 2. طباعة الفاتورة
- **زر طباعة:** من صفحة تعديل الطلب
- **مسار PDF:** `/invoice/{order}` (يتطلب تسجيل الدخول)
- **محتوى الفاتورة:** بيانات المتجر، العميل، المنتجات، المجموع

### 3. الدومين المخصص
- **صفحة جديدة:** إعدادات → الدومين الخاص
- **ربط الدومين:** إدخال دومين مثل `shop.example.com`
- **تعليمات DNS:** وصف لإعداد سجلات A و CNAME
- **زر عرض المتجر:** يوجّه إلى الدومين المخصص إن وُجد، وإلا إلى الرابط الافتراضي
- **المتجر (Storefront):** يدعم الدومين من خلال `window.location.hostname` عند غياب `?domain=`

### 4. لوحة التاجر
- **إحصائيات:** إجمالي المبيعات، طلبات جديدة، طلبات اليوم (مع الإيراد)، منتجات نشطة
- **إجراء سريع:** زر "رقم التتبع" في صف الطلب لتحديث الرقم
- **صفحة التكاملات:** إعداد Telegram (Bot Token و Channel ID)

### 5. لوحة الإدارة
- **إحصائيات:** إجمالي المتاجر، الطلبات، الإيرادات، المتاجر النشطة

### 6. تكامل Telegram
- **إشعار عند طلب جديد:** إرسال تلقائي إلى القناة/المجموعة عند إنشاء طلب
- **إعدادات التاجر:** صفحة التكاملات لإدخال التوكن ومعرف القناة

### 7. تصدير الطلبات
- **تصدير Excel/CSV:** من قائمة الطلبات (زر "تصدير")
- **الأعمدة:** رقم الطلب، العميل، الهاتف، العنوان، الإجمالي، الحالة، رقم التتبع، التاريخ

---

## الملفات الجديدة
- `app/Enums/OrderStatus.php`
- `app/Models/OrderStatusHistory.php`
- `app/Observers/OrderObserver.php`
- `app/Http/Controllers/InvoiceController.php`
- `app/Filament/Exports/OrderExporter.php`
- `app/Filament/Seller/Pages/StoreDomainSettings.php`
- `app/Filament/Seller/Pages/StoreIntegrationsSettings.php`
- `app/Filament/Seller/Resources/Orders/RelationManagers/StatusHistoryRelationManager.php`
- `resources/views/invoices/order.blade.php`

## اعتماديات جديدة
- `barryvdh/laravel-dompdf` لطباعة الفاتورة

## نقاط مهمة للنشر
1. تشغيل `php artisan migrate`
2. تشغيل `composer install` (يتضمن dompdf)
3. إعداد Queue للمُصدَّرات الكبيرة (اختياري)
4. إضافة دومينات مخصصة إلى CORS إن لزم الأمر
